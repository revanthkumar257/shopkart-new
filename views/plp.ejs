<%- include('partials/head', { title, initialPush, cartCount }) %>
  <div class="plp-background" style="background-image: url('<%= encodeURI('https://images.unsplash.com/photo-1581091012184-5c4c11c3f024') %>');"></div>
  <div class="plp-toolbar">
    <div class="muted">Showing <%= products.length %> items</div>
    <div class="filters">
      <select>
        <option>Category: <%= selectedCategory || 'all' %></option>
      </select>
      <select>
        <option>Sort: Most Popular</option>
        <option>Sort: Price Low → High</option>
      </select>
    </div>
  </div>
  <h2><%= selectedCategory && selectedCategory !== 'all' ? selectedCategory.charAt(0).toUpperCase() + selectedCategory.slice(1) : 'All categories' %></h2>
  <p class="muted">Curated deals across <%= selectedCategory && selectedCategory !== 'all' ? selectedCategory : 'ShopKart' %>.</p>
  <% if (!products.length) { %>
    <p class="muted">No products found in this category. Try All.</p>
  <% } else { %>
    <div class="grid plp-grid">
      <% products.forEach((product, idx) => { %>
        <div class="card">
          <div class="card-image">
            <a href="/pdp/<%= product.id %>" 
               data-action="view-product"
               data-product-id="<%= product.id %>"
               data-product-name="<%= product.name %>"
               data-product-category="<%= product.category %>"
               data-brand="<%= product.brand %>"
               data-price="<%= product.price %>"
               data-position="<%= product.position %>"
               data-href="/pdp/<%= product.id %>"
               style="display:block;width:100%;height:100%;">
              <img src="<%= encodeURI(product.image) %>" alt="<%= product.name %>" onerror="this.onerror=null; this.src=this.src.startsWith('http') ? '/images/placeholders/missing-banner.png' : this.src;" />
            </a>
            <% if (product.badge) { %><div class="badge"><%= product.badge %></div><% } %>
            <div class="brand-pill"><%= product.brand %></div>
          </div>
          <h3><%= product.name %></h3>
          <p class="muted"><%= product.category %></p>
          <p class="price">$<%= product.price %> <span class="muted" style="text-decoration:line-through;">$<%= product.mrp %></span></p>
          <div class="stars">★★★★☆</div>
          <a
            class="button secondary"
            href="/pdp/<%= product.id %>"
            data-action="view-product"
            data-product-id="<%= product.id %>"
            data-product-name="<%= product.name %>"
            data-product-category="<%= product.category %>"
            data-brand="<%= product.brand %>"
            data-price="<%= product.price %>"
            data-position="<%= product.position %>"
            data-href="/pdp/<%= product.id %>"
          >
            View
          </a>
        </div>
      <% }) %>
    </div>
  <% } %>
<%- include('partials/footer') %>

